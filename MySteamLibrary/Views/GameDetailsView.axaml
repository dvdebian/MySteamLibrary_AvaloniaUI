<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:MySteamLibrary.ViewModels"
             xmlns:conv="using:MySteamLibrary.Converters"
             x:Class="MySteamLibrary.Views.GameDetailsView"
             x:DataType="vm:GameDetailsViewModel">

    <UserControl.Resources>
        <conv:BitmapValueConverter x:Key="VariableImageConverter"/>
    </UserControl.Resources>

    <UserControl.Styles>
        <Style Selector="Button.CloseBtn">
            <Setter Property="Background" Value="#3d4450"/>
            <Setter Property="Foreground" Value="#9fa3a9"/>
            <Setter Property="Transitions">
                <Transitions>
                    <BrushTransition Property="Background" Duration="0:0:0.2"/>
                    <BrushTransition Property="Foreground" Duration="0:0:0.2"/>
                </Transitions>
            </Setter>
        </Style>

        <Style Selector="Button.CloseBtn:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#4d5460"/> 
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <Style Selector="TextBlock.Label">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#858d97"/>
            <Setter Property="LetterSpacing" Value="1.5"/>
        </Style>
    </UserControl.Styles>

    <Panel Background="#CC000000">
        <Button Command="{Binding CloseCommand}" 
                Background="Transparent" 
                BorderThickness="0" 
                HorizontalAlignment="Stretch" 
                VerticalAlignment="Stretch"/>

        <Border Background="#1b2838"
                Width="850"
                Height="600"
                CornerRadius="12"
                BoxShadow="0 25 60 0 Black"
                VerticalAlignment="Center"
                HorizontalAlignment="Center">
            
            <Grid ColumnDefinitions="400, *">
                
                <!-- Image Section with Overlay Edit Button -->
                <Grid Grid.Column="0">
                    <Border CornerRadius="12,0,0,12" 
                            ClipToBounds="True"
                            Background="#101010">
                        <Image Source="{Binding SelectedGame.ImagePath, Converter={StaticResource VariableImageConverter}}" 
                               Stretch="UniformToFill"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"/>
                    </Border>
                    
                    <!-- Edit Button Overlay (Bottom-Left Corner) -->
                    <Button Command="{Binding SetCustomImageCommand}"
                            ToolTip.Tip="Change image"
                            Width="36"
                            Height="36"
                            CornerRadius="18"
                            Background="#CC000000"
                            BorderBrush="#67c1f5"
                            BorderThickness="1"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Bottom"
                            Margin="12"
                            Padding="0"
                            Cursor="Hand">
                        
                        <!-- Pencil/Edit Icon (SVG Path) -->
                        <Viewbox Width="16" Height="16">
                            <Canvas Width="24" Height="24">
                                <Path Data="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" 
                                      Fill="White"/>
                            </Canvas>
                        </Viewbox>
                        
                        <!-- Button Hover Effect -->
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background" Value="#DD000000"/>
                                <Setter Property="BorderBrush" Value="#8fdbff"/>
                            </Style>
                            <Style Selector="Button:pressed">
                                <Setter Property="Background" Value="#EE000000"/>
                            </Style>
                        </Button.Styles>
                    </Button>
                    
                    <!-- Reset Button Overlay (Bottom-Right Corner) -->
                    <!-- Refreshes the image by re-downloading from Steam CDN -->
                    <Button Command="{Binding RemoveCustomImageCommand}"
                            ToolTip.Tip="Refresh image"
                            Width="36"
                            Height="36"
                            CornerRadius="18"
                            Background="#CC000000"
                            BorderBrush="#f5a742"
                            BorderThickness="1"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom"
                            Margin="12"
                            Padding="0"
                            Cursor="Hand">
                        
                        <!-- Circular Arrow/Reset Icon (Unicode) -->
                        <TextBlock Text="↻" 
                                   FontSize="20"
                                   Foreground="White"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
                        
                        <!-- Button Hover Effect -->
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background" Value="#DD000000"/>
                                <Setter Property="BorderBrush" Value="#ffc266"/>
                            </Style>
                            <Style Selector="Button:pressed">
                                <Setter Property="Background" Value="#EE000000"/>
                            </Style>
                        </Button.Styles>
                    </Button>
                </Grid>

                <Grid Grid.Column="1" RowDefinitions="Auto, Auto, *">
                    
                    <Button Grid.Row="0" 
                            Classes="CloseBtn"
                            Command="{Binding CloseCommand}" 
                            Content="✕" 
                            IsCancel="True"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            CornerRadius="4"
                            Margin="20"
                            Padding="12,8"
                            FontSize="18"
                            Cursor="Hand"/>

                    <Border Grid.Row="1" Padding="35,0,35,10">
                        <StackPanel Spacing="10">
                            <TextBlock Text="{Binding SelectedGame.Title}" 
                                       FontSize="42" 
                                       FontWeight="Black" 
                                       TextWrapping="Wrap"
                                       Foreground="White"
                                       LineHeight="46"/>
                            
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="TIME PLAYED" Classes="Label"/>
                                <TextBlock Text="{Binding SelectedGame.PlayTime}" 
                                           FontSize="13" 
                                           Foreground="#67c1f5"
                                           FontWeight="SemiBold"/>
                            </StackPanel>
                            
                            <Separator Background="#3d4450" Height="1" Margin="0,20,0,0"/>
                        </StackPanel>
                    </Border>

                    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                        <Border Padding="35,15,35,40">
                            <StackPanel Spacing="10">
                                <TextBlock Text="DESCRIPTION" Classes="Label"/>
                                <TextBlock Text="{Binding SelectedGame.Description}" 
                                           FontSize="16" 
                                           Foreground="#CCCCCC" 
                                           LineHeight="24"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>
                    </ScrollViewer>
                </Grid>
            </Grid>
        </Border>
    </Panel>
</UserControl>