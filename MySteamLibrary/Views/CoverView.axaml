<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MySteamLibrary.ViewModels"
             xmlns:models="using:MySteamLibrary.Models"
             xmlns:conv="using:MySteamLibrary.Converters"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="MySteamLibrary.Views.CoverView"
             x:DataType="vm:CoverViewModel">

    <UserControl.Resources>
        <conv:BitmapValueConverter x:Key="VariableImageConverter"/>
        <conv:CenterPaddingConverter x:Key="CenterPaddingConverter"/>
    </UserControl.Resources>

    <UserControl.Styles>
        <Style Selector="ListBoxItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="40,60"/> 
            <Setter Property="RenderTransformOrigin" Value="50%,50%"/>
            <Setter Property="Transitions">
                <Transitions>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2"/>
                </Transitions>
            </Setter>
        </Style>

        <Style Selector="ListBoxItem:selected">
            <Setter Property="RenderTransform" Value="scale(1.2)"/>
            <Setter Property="ZIndex" Value="10"/>
        </Style>

        <Style Selector="ListBoxItem /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="Transparent" />
        </Style>
    </UserControl.Styles>

    <ListBox x:Name="CoverList"
             ItemsSource="{Binding Games}"
             SelectedItem="{Binding Parent.SelectedGame}"
             Background="Transparent"
             PointerWheelChanged="OnPointerWheelChanged"
             ScrollViewer.HorizontalScrollBarVisibility="Hidden"
             ScrollViewer.VerticalScrollBarVisibility="Disabled">
        
        <ListBox.Template>
            <ControlTemplate>
                <Border Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="{TemplateBinding CornerRadius}">
                    <ScrollViewer Name="PART_ScrollViewer"
                                  HorizontalScrollBarVisibility="{TemplateBinding (ScrollViewer.HorizontalScrollBarVisibility)}"
                                  VerticalScrollBarVisibility="{TemplateBinding (ScrollViewer.VerticalScrollBarVisibility)}">
                        <Border Padding="{Binding Bounds.Width, 
                                         RelativeSource={RelativeSource TemplatedParent}, 
                                         Converter={StaticResource CenterPaddingConverter}}">
                            <ItemsPresenter Name="PART_ItemsPresenter"
                                            ItemsPanel="{TemplateBinding ItemsPanel}" />
                        </Border>
                    </ScrollViewer>
                </Border>
            </ControlTemplate>
        </ListBox.Template>

        <ListBox.ItemsPanel>
            <ItemsPanelTemplate>
                <VirtualizingStackPanel Orientation="Horizontal" VerticalAlignment="Center"/>
            </ItemsPanelTemplate>
        </ListBox.ItemsPanel>

        <ListBox.ItemTemplate>
            <DataTemplate x:DataType="models:GameModel">
                <StackPanel Spacing="15" Width="220">
                    <Border Width="220" Height="330" 
                            Background="#2a2e33" 
                            CornerRadius="6" 
                            ClipToBounds="True"
                            BoxShadow="0 10 20 0 #66000000">
                        <Panel>
                            <Image Source="{Binding ImagePath, Converter={StaticResource VariableImageConverter}}" 
                                   Stretch="UniformToFill"/>
                        </Panel>
                    </Border>
                    <TextBlock Text="{Binding Title}" 
                               HorizontalAlignment="Center" 
                               FontSize="16" 
                               FontWeight="Bold"
                               Foreground="White"
                               TextAlignment="Center"
                               TextWrapping="Wrap"/>
                </StackPanel>
            </DataTemplate>
        </ListBox.ItemTemplate>
    </ListBox>
</UserControl>